// third-party
const Bluebird = require('bluebird');
const fileSaver = require('file-saver');

module.exports = function (habemus, options) {

  habemus.ui.fileTree.menu.branch.addOptions([
    {
      label: 'download directory',
      callback: function (data) {
        var directory = data.context;

        var downloadName = directory.name + '.zip';
        
        return habemus.services.zip.zip(directory.path).then(function (zipFile) {
          fileSaver.saveAs(zipFile, downloadName);
        })
        .catch(function (err) {
          if (err.canceled) {
            // user canceled
            return;
          }

          habemus.services.dialogs.alert('Error downloading zip file');
          console.warn(err);
        });
      },
    }
  ]);

};
