/**
 * Prepares a set of dialogs specific for dealing with project-related operations.
 * Project related operations are very sensitive for the service worker version
 * of the webeditor, as the user may not yet have an account for
 * storing files in the cloud.
 */

// third-party
const fileSaver = require('file-saver');


module.exports = function (habemus, options) {
  // create an instance of the new project dialog
  var newProjectDialog = document.createElement('habemus-new-project-dialog');
  document.body.appendChild(newProjectDialog);

  // create an instance of the publish project dialog
  var publishProjectDialog = document.createElement('habemus-publish-project-dialog');
  document.body.appendChild(publishProjectDialog);
  publishProjectDialog.addEventListener('download-requested', function () {
    habemus.services.zip.zip('/').then(function (zipFile) {
      fileSaver.saveAs(zipFile, 'project');
    });
  });

  // flush polymer dom, as to ensure all created elements
  // are ready for usage
  Polymer.dom.flush();

  // enable translations for all elements
  newProjectDialog.set('translate', habemus.services.language.t);
  publishProjectDialog.set('translate', habemus.services.language.t);

  return {
    'new': newProjectDialog,
    publish: publishProjectDialog,
  };
};
