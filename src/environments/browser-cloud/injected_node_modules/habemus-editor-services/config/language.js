// native
const url = require('url');

// constants
const CONSTANTS = require('../../../../../constants');

/**
 * TODO: separate into single file
 * 
 * Language definition cascade:
 * - queryString.lang
 * - localStorage
 * - account's workspace application configuration
 * - navigator.language
 */
function _setupLanguageResolution(account) {

  var selectedLanguageKey = url.parse(window.location.toString(), true).query.lang;

  if (!selectedLanguageKey) {
    try {
      selectedLanguageKey = window.localStorage.getItem(
        CONSTANTS.HABEMUS_LANGUAGE_LS_KEY
      );
    } catch (e) {
      // probably in private mode
    }
  }

  if (!selectedLanguageKey) {
    selectedLanguageKey = account.applicationConfig.workspace.language;
  }

  if (!selectedLanguageKey) {
    selectedLanguageKey = window.navigator.language;
  }


  if (selectedLanguageKey) {
    try {
      window.localStorage.setItem(
        CONSTANTS.HABEMUS_LANGUAGE_LS_KEY,
        selectedLanguageKey
      );
    } catch (e) {
      // probably in private mode
      console.warn('could not save selectedLanguageKey to localStorage');
    }
  }
}

module.exports = function (account, habemus, options) {
  
  _setupLanguageResolution(account);
  
  return {
    baseURL: process.env.LANGUAGES_BASE_URL || '/resources/languages',

    fallback: 'en-US',

    languages: [
      {
        label: 'English (US)',
        key: 'en-US',
        data: require('../../../../../resources/languages/en-US.json'),
      },
      {
        label: 'Português (BR)',
        key: 'pt-BR',
      },
      {
        label: '中文 (简体)',
        key: 'zn-CH',
      }
    ],
  };
};
