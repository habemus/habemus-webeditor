// third-party
const Bluebird = require('bluebird');
const fileSaver = require('file-saver');

module.exports = function (habemus, options) {

  habemus.ui.fileTree.menu.branch.addOptions([
    {
      label: 'download zip',
      callback: function (data) {
        var directory = data.context;

        return habemus.services.dialogs.prompt('Save as', {
          submit: 'download',
          defaultValue: directory.name + '.zip',
        })
        .then(function (downloadName) {
          return habemus.services.zip.zip(directory.path).then(function (zipFile) {
            fileSaver.saveAs(zipFile, downloadName);
          });
        })
        .catch(function (err) {
          if (err.canceled) {
            // user canceled
            return;
          }

          habemus.services.dialogs.alert('Error downloading zip file');
          console.warn(err);
        });
      },
    }
  ]);

};
