// constants
const ZIP_FILE_RE = /(.+)?\.zip$/;

module.exports = function (habemus, options) {

  habemus.ui.fileTree.menu.leaf.addOptions([
    {
      label: 'unzip',
      hide: function (data) {
        return !ZIP_FILE_RE.test(data.context.path);
      },
      callback: function (data) {
        var file = data.context;

        // we can safely assume the match will be successful,
        // as we've already tested it in the `hide` phase.
        var dirname = file.path.match(ZIP_FILE_RE)[1];

        habemus.services.zip.unzip(file.path, dirname).catch(function (err) {
          habemus.services.dialogs.alert('Error unzipping \'' + file.name + '\'');
          console.warn(err);
        });
      },
    }
  ]);

};
